name: abu

services:
  db:
    image: mariadb:11.4
    container_name: abu-db
    restart: unless-stopped
    environment:
      MARIADB_ROOT_PASSWORD: root
      MARIADB_DATABASE: abu-answers
    volumes:
      - abu-db-data:/var/lib/mysql
    ports:
      - "8876:3306"
    networks:
      - abu

  back:
    build:
      context: ./abu-back
    container_name: abu-back
    restart: unless-stopped
    environment:
      DB_HOST: abu-db
      DB_USER: root
      DB_PASSWORD: root
      DB_NAME: abu-answers
      APP_PATH: ""
      DEBUG: "true"
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    depends_on:
      - db
    ports:
      - "8870:80"
    networks:
      - abu

  back-abu:
    build:
      context: ./abu-back-abu
    container_name: abu-back-abu
    restart: unless-stopped
    environment:
      DB_HOST: abu-db
      DB_USER: root
      DB_PASSWORD: root
      DB_NAME: abu
      APP_PATH: ""
      DEBUG: "true"
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    depends_on:
      - db
    ports:
      - "8873:80"
    networks:
      - abu

  front:
    build:
      context: ./abu-front
    container_name: abu-front
    restart: unless-stopped
    ports:
      - "8871:80"
    networks:
      - abu

  svelte:
    build:
      context: ./abu-svelte
    container_name: abu-svelte
    restart: unless-stopped
    ports:
      - "8872:5173"
    networks:
      - abu

  phpmyadmin:
    image: phpmyadmin:5.2
    container_name: abu-phpmyadmin
    restart: unless-stopped
    environment:
      PMA_HOST: abu-db
      PMA_USER: root
      PMA_PASSWORD: root
    depends_on:
      - db
    ports:
      - "8875:80"
    networks:
      - abu

volumes:
  abu-db-data:

networks:
  abu:
    name: abu
